# -*- coding: utf-8 -*-
"""Full_Code

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1CGQQ_mxvMN-inRDXncd8DCVhCCZjjZR-

# **HackBio_StageOne**

Write a python function for translating DNA to protein


Write a python function for calculating the hamming distance between your slack username (e.g josoga) and twitter/X (joseph) handle (synthesize one if you don’t have one). Feel free to pad it with extra words if they are not of the same length.
"""

"""
HackBio Stage One – Team Histidine
Author: Saumi Shah
GitHub: https://github.com/saumis22
LinkedIn: www.linkedin.com/in/saumishah
This file contains: https://www.linkedin.com/in/saumi-shah-1010991a7
1. DNA → Protein translation with FASTA reading & configurable unknown codons
2. Hamming distance function with input validation
3. Additional DNA/protein metrics (GC-content and codon count)
4. Surprise Task A & B (All 6 required plots)
5. All recommended imports requested by reviewers
"""

# ============================================================
# IMPORTS (Reviewers expected these imports)
# ============================================================
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import csv

# ============================================================
# DNA CODON TABLE
# ============================================================
CODON_TABLE = {
    "TTT":"F","TTC":"F","TTA":"L","TTG":"L","CTT":"L","CTC":"L","CTA":"L","CTG":"L",
    "ATT":"I","ATC":"I","ATA":"I","ATG":"M",
    "GTT":"V","GTC":"V","GTA":"V","GTG":"V",
    "TCT":"S","TCC":"S","TCA":"S","TCG":"S","AGT":"S","AGC":"S",
    "CCT":"P","CCC":"P","CCA":"P","CCG":"P",
    "ACT":"T","ACC":"T","ACA":"T","ACG":"T",
    "GCT":"A","GCC":"A","GCA":"A","GCG":"A",
    "TAT":"Y","TAC":"Y","CAT":"H","CAC":"H","CAA":"Q","CAG":"Q",
    "AAT":"N","AAC":"N","AAA":"K","AAG":"K",
    "GAT":"D","GAC":"D","GAA":"E","GAG":"E",
    "TGT":"C","TGC":"C","TGG":"W",
    "CGT":"R","CGC":"R","CGA":"R","CGG":"R","AGA":"R","AGG":"R",
    "GGT":"G","GGC":"G","GGA":"G","GGG":"G",
    "TAA":"*","TAG":"*","TGA":"*"
}

# ============================================================
# FASTA READER (Recommended by reviewer)
# ============================================================
def read_fasta(file_path):
    """
    Reads a FASTA file from disk and returns the sequence.
    """
    try:
        with open(file_path, "r") as f:
            lines = f.readlines()
        seq = "".join([l.strip() for l in lines if not l.startswith(">")])
        return seq.upper()
    except Exception as e:
        raise IOError(f"Error reading FASTA: {e}")

# ============================================================
# DNA → PROTEIN FUNCTION (Upgraded Version)
# ============================================================
def translate_dna(dna_seq, frame=0, to_stop=True, unknown_strategy="X"):
    """
    Translate DNA sequence to amino-acid sequence.

    unknown_strategy:
        "X" → default unknown amino acid
        "skip" → ignore unknown codons
        "error" → raise an exception
    """
    seq = dna_seq.upper().replace(" ", "")

    if any(ch not in "ATGCN" for ch in seq):
        raise ValueError("Invalid DNA sequence. Allowed bases: A,T,G,C,N")

    protein = []

    for i in range(frame, len(seq) - 2, 3):
        codon = seq[i:i+3]

        # Handling unknown codons
        if "N" in codon:
            if unknown_strategy == "X":
                protein.append("X")
                continue
            elif unknown_strategy == "skip":
                continue
            elif unknown_strategy == "error":
                raise ValueError(f"Unknown codon: {codon}")

        aa = CODON_TABLE.get(codon, "X")

        if aa == "*":
            if to_stop:
                break
            protein.append("*")
        else:
            protein.append(aa)

    return "".join(protein)

# ============================================================
# ADDITIONAL METRICS (Reviewer Suggested Scientific Value)
# ============================================================
def gc_content(dna):
    return round((dna.count("G") + dna.count("C")) / len(dna) * 100, 2)

def codon_count(dna):
    return len(dna) // 3

# ============================================================
# HAMMING DISTANCE (Improved Validation)
# ============================================================
def hamming_distance(str1, str2):
    if not isinstance(str1, str) or not isinstance(str2, str):
        raise TypeError("Inputs must be strings.")

    max_len = max(len(str1), len(str2))
    str1, str2 = str1.ljust(max_len), str2.ljust(max_len)

    return sum(c1 != c2 for c1, c2 in zip(str1, str2))

# ============================================================
# DEMO for Task 1 & 2
# ============================================================
test_dna = "ATGGCCATTGTAATGGGCCGCTGAAAGGGTGCCCGATAG"
print("Protein Translation:", translate_dna(test_dna))
print("GC Content:", gc_content(test_dna))
print("Codon Count:", codon_count(test_dna))

slack = "saumi_shah"
twitter = "saumi@99"
print("Hamming Distance:", hamming_distance(slack, twitter))

# ============================================================
# SURPRISE TASK – ALL 6 PLOTS (Using seaborn + matplotlib)
# ============================================================

# -----------------------------
# DATASETS
# -----------------------------
norm_counts_url = "https://raw.githubusercontent.com/HackBio-Internship/2025_project_collection/refs/heads/main/Python/Dataset/hbr_uhr_top_deg_normalized_counts.csv"
df_norm = pd.read_csv(norm_counts_url, index_col=0)

deg_url = "https://raw.githubusercontent.com/HackBio-Internship/2025_project_collection/refs/heads/main/Python/Dataset/hbr_uhr_deg_chr22_with_significance.csv"
df_deg = pd.read_csv(deg_url)

bc_url = "https://raw.githubusercontent.com/HackBio-Internship/2025_project_collection/refs/heads/main/Python/Dataset/data-3.csv"
df_bc = pd.read_csv(bc_url)

features = ['radius_mean','texture_mean','perimeter_mean','area_mean','smoothness_mean','compactness_mean']
df_bc = df_bc.dropna(subset=features)

# -----------------------------
# PLOTTING GRID
# -----------------------------
fig, axes = plt.subplots(3,3, figsize=(20,15))
axes = axes.flatten()

# 1A – Heatmap
sns.heatmap(df_norm, cmap="Blues", ax=axes[0])
axes[0].set_title("1A: Heatmap of Normalized DEGs")

# 1B – Volcano Plot
sns.scatterplot(
    x="log2FoldChange", y="-log10PAdj", hue="significance",
    data=df_deg, ax=axes[1], palette="coolwarm"
)
axes[1].axvline(1, linestyle="--", color="grey")
axes[1].axvline(-1, linestyle="--", color="grey")
axes[1].set_title("1B: Volcano Plot")

# 1C – Scatter Plot
sns.scatterplot(
    data=df_bc, x="radius_mean", y="texture_mean", hue="diagnosis", ax=axes[2]
)
axes[2].set_title("1C: Radius vs Texture")

# 1D – Correlation Heatmap
sns.heatmap(df_bc[features].corr(), annot=True, cmap="Blues", ax=axes[3])
axes[3].set_title("1D: Correlation Heatmap")

# 1E – Smoothness vs Compactness
sns.scatterplot(
    data=df_bc, x="smoothness_mean", y="compactness_mean", hue="diagnosis", ax=axes[4]
)
axes[4].set_title("1E: Smoothness vs Compactness")

# 1F – Density Plot (KDE)
sns.kdeplot(df_bc[df_bc["diagnosis"]=="M"]["area_mean"], fill=True, ax=axes[5], color="blue", label="Malignant")
sns.kdeplot(df_bc[df_bc["diagnosis"]=="B"]["area_mean"], fill=True, ax=axes[5], color="orange", label="Benign")
axes[5].set_title("1F: Density Plot of Area Mean")
axes[5].legend()

# Turn off leftover subplots
for i in range(6,9):
    axes[i].axis("off")

plt.tight_layout()
plt.show()